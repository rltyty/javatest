package korhal.sun.misc;

import static org.junit.jupiter.api.Assertions.assertEquals;

import java.lang.reflect.Field;
import org.junit.jupiter.api.Test;
import sun.misc.Unsafe;

public class UnsafeTest {
  public static void main(String args[]) throws Exception {
    Field f = Unsafe.class.getDeclaredField("theUnsafe");
    f.setAccessible(true);
    Unsafe u = (Unsafe) f.get(null);

    long address = u.allocateMemory(4); // Allocate 4 bytes
    u.putInt(address, 12345); // Write value
    int x = u.getInt(address); // Read value
    System.out.println(x);

    u.freeMemory(address); // Clean up
  }

  @Test
  public void unsafe_test_1() throws Exception {
    Field f = Unsafe.class.getDeclaredField("theUnsafe");
    f.setAccessible(true);
    Unsafe u = (Unsafe) f.get(null);

    long address = u.allocateMemory(4); // Allocate 4 bytes
    u.putInt(address, 12345); // Write value
    int x = u.getInt(address); // Read value
    assertEquals(12345, x);

    u.freeMemory(address); // Clean up
  }

}
